<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Seal Chat</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
	<style>
		.messages-container::-webkit-scrollbar {
			width: 4px;
		}

		.messages-container::-webkit-scrollbar-track {
			background: #f1f1f1;
		}

		.messages-container::-webkit-scrollbar-thumb {
			background: #888;
			border-radius: 2px;
		}

		.messages-container::-webkit-scrollbar-thumb:hover {
			background: #555;
		}

		.typing-indicator::after {
			content: '...';
			animation: typing 1s infinite;
		}

		@keyframes typing {
			0% {
				content: '.';
			}

			33% {
				content: '..';
			}

			66% {
				content: '...';
			}
		}
	</style>
</head>

<body class="bg-gradient-to-br from-blue-500 to-purple-600">
	<!-- Login Section -->
	<div id="loginSection" class="min-h-screen flex items-center justify-center p-2 sm:p-4">
		<div class="w-full max-w-sm bg-white rounded-lg shadow-lg overflow-hidden">
			<div class="p-4">
				<h1 class="text-xl font-bold text-gray-800 mb-4">Seal Chat</h1>
				<!-- Tab Navigation -->
				<div class="flex border-b mb-4">
					<button onclick="showTab('create')" id="createTab"
						class="flex-1 py-2 text-sm font-medium transition focus:outline-none">
						Create Room
					</button>
					<button onclick="showTab('join')" id="joinTab"
						class="flex-1 py-2 text-sm font-medium transition focus:outline-none">
						Join Room
					</button>
				</div>

				<!-- Create Room Form -->
				<div id="createRoomTab" class="space-y-3">
					<input type="text" id="username" placeholder="Your username" maxlength="20"
						class="w-full px-3 py-2 text-sm bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
					<input type="text" id="roomName" placeholder="Room name" maxlength="30"
						class="w-full px-3 py-2 text-sm bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
					<button onclick="createRoom()"
						class="w-full py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
						Create Room
					</button>
				</div>

				<!-- Join Room Form -->
				<div id="joinRoomTab" class="hidden space-y-3">
					<input type="text" id="joinUsername" placeholder="Your username" maxlength="20"
						class="w-full px-3 py-2 text-sm bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
					<input type="text" id="roomId" placeholder="Room ID"
						class="w-full px-3 py-2 text-sm bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
					<input type="text" id="roomCode" placeholder="Room code"
						class="w-full px-3 py-2 text-sm bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
					<button onclick="joinRoom()"
						class="w-full py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
						Join Room
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Chat Section -->
	<div id="chatSection" class="hidden h-screen flex flex-col bg-white">
		<!-- Chat Header -->
		<div class="bg-white border-b px-3 py-2 shadow-sm">
			<div class="flex items-center justify-between">
				<div class="flex items-center space-x-3">
					<button onclick="showRoomInfo()" class="text-gray-600 hover:text-gray-800 focus:outline-none">
						<i class="fas fa-info-circle"></i>
					</button>
					<div>
						<h2 id="roomHeader" class="font-medium text-gray-800 text-base"></h2>
						<div class="flex items-center space-x-2">
							<span id="onlineUsers" class="text-xs text-gray-500"></span>
							<span id="typingIndicator" class="hidden text-xs text-gray-500 typing-indicator"></span>
						</div>
					</div>
				</div>
				<button onclick="leaveRoom()" class="text-red-500 hover:text-red-600 focus:outline-none">
					<i class="fas fa-sign-out-alt"></i>
				</button>
			</div>
		</div>

		<!-- Room Info Modal -->
		<div id="roomInfoModal" class="hidden fixed inset-0 flex items-center justify-center bg-black/50 p-3 z-50">
			<div class="bg-white rounded-lg max-w-xs w-full p-3">
				<h3 class="text-base font-medium mb-2">Room Info</h3>
				<div class="space-y-2 mb-3 text-sm">
					<div class="bg-gray-100 p-2 rounded">
						<p class="text-xs font-medium text-gray-500">Room ID</p>
						<p id="roomIdDisplay" class="text-gray-800 break-all"></p>
					</div>
					<div class="bg-gray-100 p-2 rounded">
						<p class="text-xs font-medium text-gray-500">Room Code</p>
						<p id="roomCodeDisplay" class="text-gray-800 break-all"></p>
					</div>
				</div>
				<button onclick="hideRoomInfo()"
					class="w-full py-1.5 text-white bg-blue-600 rounded-md hover:bg-blue-700 transition">Close</button>
			</div>
		</div>

		<!-- Messages Container -->
		<div id="messagesContainer" class="flex-1 overflow-y-auto p-3 space-y-2 messages-container">
			<!-- Messages will be inserted here -->
		</div>

		<!-- Message Input -->
		<div class="border-t p-2">
			<div class="flex items-center space-x-2">
				<input type="text" id="messageInput" placeholder="Type a message..."
					class="flex-1 px-3 py-2 text-sm bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
				<button onclick="sendMessage()"
					class="p-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
					<i class="fas fa-paper-plane"></i>
				</button>
			</div>
		</div>
	</div>

	<script>
		const socket = io('https://private-chat.koyeb.app');
		let currentRoom = null;
		let currentUsername = null;
		let typingTimeout = null;

		// Tab switching
		function showTab(tab) {
			const createTab = document.getElementById('createTab');
			const joinTab = document.getElementById('joinTab');
			const createRoomTab = document.getElementById('createRoomTab');
			const joinRoomTab = document.getElementById('joinRoomTab');

			if (tab === 'create') {
				createTab.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
				joinTab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
				createRoomTab.classList.remove('hidden');
				joinRoomTab.classList.add('hidden');
			} else {
				joinTab.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
				createTab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
				joinRoomTab.classList.remove('hidden');
				createRoomTab.classList.add('hidden');
			}
		}

		// Show/hide room info
		function showRoomInfo() {
			document.getElementById('roomInfoModal').classList.remove('hidden');
		}

		function hideRoomInfo() {
			document.getElementById('roomInfoModal').classList.add('hidden');
		}

		// Socket event listeners
		socket.on('roomCreated', (data) => {
			showChatSection(data);
			navigator.clipboard.writeText(`Room ID: ${data.roomId}\nRoom Code: ${data.roomCode}`);
			alert('Room created! Room ID and Code have been copied to your clipboard.');
		});

		socket.on('joinedRoom', (data) => {
			showChatSection(data);
		});

		socket.on('message', (data) => {
			appendMessage(data);
		});

		socket.on('userJoined', (data) => {
			updateOnlineUsers(data.users);
			appendSystemMessage(`${data.username} joined`);
		});

		socket.on('userLeft', (data) => {
			updateOnlineUsers(data.users);
			appendSystemMessage(`${data.username} left`);
		});

		socket.on('userTyping', (data) => {
			const typingIndicator = document.getElementById('typingIndicator');
			if (data.isTyping && data.username !== currentUsername) {
				typingIndicator.textContent = `${data.username} is typing`;
				typingIndicator.classList.remove('hidden');
			} else {
				typingIndicator.classList.add('hidden');
				typingIndicator.textContent = '';
			}
		});

		socket.on('roomExpired', (message) => {
			alert(message);
			resetToLogin();
		});

		socket.on('error', (error) => {
			alert(error);
		});

		// UI Functions
		function showChatSection(data) {
			document.getElementById('loginSection').classList.add('hidden');
			document.getElementById('chatSection').classList.remove('hidden');
			document.getElementById('roomHeader').textContent = data.roomName;
			document.getElementById('roomIdDisplay').textContent = data.roomId;
			document.getElementById('roomCodeDisplay').textContent = data.roomCode;
			currentRoom = data.roomId;
			updateOnlineUsers(data.users);
		}

		function resetToLogin() {
			document.getElementById('chatSection').classList.add('hidden');
			document.getElementById('loginSection').classList.remove('hidden');
			document.getElementById('messagesContainer').innerHTML = '';
			currentRoom = null;
			currentUsername = null;
		}

		function updateOnlineUsers(users) {
			document.getElementById('onlineUsers').textContent = `${users.length}/6 online`;
		}

		function appendMessage(data) {
			const messagesContainer = document.getElementById('messagesContainer');
			const messageDiv = document.createElement('div');
			const isOwnMessage = data.username === currentUsername;
			const time = new Date(data.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

			messageDiv.className = `flex ${isOwnMessage ? 'justify-end' : 'justify-start'}`;
			messageDiv.innerHTML = `
                <div class="max-w-[85%] rounded-lg px-3 py-1.5 ${isOwnMessage ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800'}">
                    ${!isOwnMessage ? `<div class="text-xs font-medium mb-0.5">${data.username}</div>` : ''}
                    <div class="text-sm break-words">${data.message}</div>
                    <div class="text-[10px] mt-0.5 ${isOwnMessage ? 'text-blue-100' : 'text-gray-500'}">${time}</div>
                </div>
            `;

			messagesContainer.appendChild(messageDiv);
			messagesContainer.scrollTop = messagesContainer.scrollHeight;
		}

		function appendSystemMessage(message) {
			const messagesContainer = document.getElementById('messagesContainer');
			const messageDiv = document.createElement('div');
			messageDiv.className = 'flex justify-center';
			messageDiv.innerHTML = `
                <div class="text-[10px] text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full">
                    ${message}
                </div>
            `;
			messagesContainer.appendChild(messageDiv);
			messagesContainer.scrollTop = messagesContainer.scrollHeight;
		}

		// User Actions
		function createRoom() {
			const roomName = document.getElementById('roomName').value.trim();
			const username = document.getElementById('username').value.trim();

			if (!roomName || !username) {
				alert('Please fill in all fields');
				return;
			}

			currentUsername = username;
			socket.emit('createRoom', { roomName, username });
		}

		function joinRoom() {
			const roomId = document.getElementById('roomId').value.trim();
			const roomCode = document.getElementById('roomCode').value.trim();
			const username = document.getElementById('joinUsername').value.trim();

			if (!roomId || !roomCode || !username) {
				alert('Please fill in all fields');
				return;
			}

			currentUsername = username;
			socket.emit('joinRoom', { roomId, roomCode, username });
		}

		function sendMessage() {
			const messageInput = document.getElementById('messageInput');
			const message = messageInput.value.trim();

			if (!message) return;

			socket.emit('message', {
				roomId: currentRoom,
				message
			});

			messageInput.value = '';
			messageInput.focus();

			// Clear typing indicator when sending message
			if (typingTimeout) {
				clearTimeout(typingTimeout);
				socket.emit('typing', {
					roomId: currentRoom,
					isTyping: false
				});
			}
		}

		function handleTyping() {
			if (typingTimeout) clearTimeout(typingTimeout);

			socket.emit('typing', {
				roomId: currentRoom,
				isTyping: true
			});

			typingTimeout = setTimeout(() => {
				socket.emit('typing', {
					roomId: currentRoom,
					isTyping: false
				});
			}, 1000);
		}

		function leaveRoom() {
			if (confirm('Are you sure you want to leave this room?')) {
				socket.emit('leaveRoom', {
					roomId: currentRoom,
					username: currentUsername
				});
				resetToLogin();
			}
		}

		// Event Listeners
		document.getElementById('messageInput').addEventListener('input', handleTyping);

		document.getElementById('messageInput').addEventListener('keypress', (e) => {
			if (e.key === 'Enter') {
				sendMessage();
			}
		});

		// Initialize
		showTab('create');

		// Handle window close
		window.addEventListener('beforeunload', () => {
			if (currentRoom) {
				socket.emit('leaveRoom', {
					roomId: currentRoom,
					username: currentUsername
				});
			}
		});
	</script>
</body>

</html>