<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SecureChat</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-sky-600">
	<!-- Mobile-Optimized Container -->
	<div class="min-h-screen flex flex-col">
		<!-- Login Section -->
		<div id="loginSection" class="flex-1 flex items-center justify-center p-4">
			<div class="w-full max-w-sm bg-white rounded-xl shadow-lg overflow-hidden">
				<!-- Tab Navigation -->
				<div class="flex border-b">
					<button onclick="showTab('create')" id="createTab"
						class="flex-1 py-3 text-sm font-medium text-center transition focus:outline-none">
						Create Room
					</button>
					<button onclick="showTab('join')" id="joinTab"
						class="flex-1 py-3 text-sm font-medium text-center transition focus:outline-none">
						Join Room
					</button>
				</div>

				<!-- Create Room Form -->
				<div id="createRoomTab" class="p-4 space-y-3">
					<div class="space-y-2">
						<input type="text" id="username" placeholder="Your username"
							class="w-full px-3 py-2 text-sm bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
						<input type="text" id="roomName" placeholder="Room name"
							class="w-full px-3 py-2 text-sm bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
					</div>
					<button onclick="createRoom()"
						class="w-full py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition">
						Create Room
					</button>
				</div>

				<!-- Join Room Form -->
				<div id="joinRoomTab" class="hidden p-4 space-y-3">
					<div class="space-y-2">
						<input type="text" id="joinUsername" placeholder="Your username"
							class="w-full px-3 py-2 text-sm bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
						<input type="text" id="roomId" placeholder="Room ID"
							class="w-full px-3 py-2 text-sm bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
						<input type="text" id="roomCode" placeholder="Room code"
							class="w-full px-3 py-2 text-sm bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
					</div>
					<button onclick="joinRoom()"
						class="w-full py-2.5 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition">
						Join Room
					</button>
				</div>
			</div>
		</div>

		<!-- Chat Section -->
		<div id="chatSection" class="hidden h-screen flex flex-col bg-white">
			<!-- Chat Header -->
			<div class="bg-white border-b px-4 py-3">
				<div class="flex items-center justify-between">
					<div class="flex items-center space-x-3">
						<button onclick="showRoomInfo()" class="text-gray-600 hover:text-gray-800">
							<i class="fas fa-info-circle"></i>
						</button>
						<div>
							<h2 id="roomHeader" class="font-semibold text-gray-800"></h2>
							<div class="flex items-center space-x-2">
								<span id="onlineUsers" class="text-xs text-gray-500"></span>
							</div>
						</div>
					</div>
					<div class="flex items-center space-x-3">
						<button onclick="leaveRoom()" class="text-red-500 hover:text-red-600">
							<i class="fas fa-sign-out-alt"></i>
						</button>
					</div>
				</div>
			</div>

			<!-- Room Info Modal -->
			<div id="roomInfoModal" class="hidden fixed inset-0 flex items-center justify-center bg-black/50 p-4">
				<div class="bg-white rounded-lg max-w-sm w-full p-4">
					<h3 class="text-lg font-semibold mb-2">Room Information</h3>
					<div class="space-y-2 mb-4">
						<p id="roomIdDisplay" class="text-sm bg-gray-100 p-2 rounded"></p>
						<p id="roomCodeDisplay" class="text-sm bg-gray-100 p-2 rounded"></p>
					</div>
					<button onclick="hideRoomInfo()" class="w-full py-2 text-sm text-white bg-blue-600 rounded-lg">Close</button>
				</div>
			</div>

			<!-- Messages Container -->
			<div id="messagesContainer" class="flex-1 overflow-y-auto p-4 space-y-3">
				<!-- Messages will be inserted here -->
			</div>

			<!-- Message Input -->
			<div class="border-t p-3">
				<div class="flex items-center space-x-2">
					<input type="text" id="messageInput" placeholder="Type a message..."
						class="flex-1 px-4 py-2 text-sm bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:border-blue-500">
					<button onclick="sendMessage()" class="p-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition">
						<i class="fas fa-paper-plane"></i>
					</button>
				</div>
			</div>
		</div>
	</div>

	<script>
		const socket = io('http://localhost:3000');
		let currentRoom = null;
		let currentUsername = null;

		// Tab switching
		function showTab(tab) {
			const createTab = document.getElementById('createTab');
			const joinTab = document.getElementById('joinTab');
			const createRoomTab = document.getElementById('createRoomTab');
			const joinRoomTab = document.getElementById('joinRoomTab');

			if (tab === 'create') {
				createTab.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
				joinTab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
				createRoomTab.classList.remove('hidden');
				joinRoomTab.classList.add('hidden');
			} else {
				joinTab.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
				createTab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
				joinRoomTab.classList.remove('hidden');
				createRoomTab.classList.add('hidden');
			}
		}

		// Show/hide room info
		function showRoomInfo() {
			document.getElementById('roomInfoModal').classList.remove('hidden');
		}

		function hideRoomInfo() {
			document.getElementById('roomInfoModal').classList.add('hidden');
		}

		// Socket event listeners
		socket.on('roomCreated', (data) => {
			showChatSection(data);
			alert(`Room created!\nRoom ID: ${data.roomId}\nRoom Code: ${data.roomCode}`);
		});

		socket.on('joinedRoom', (data) => {
			showChatSection(data);
		});

		socket.on('message', (data) => {
			appendMessage(data);
		});

		socket.on('userJoined', (data) => {
			updateOnlineUsers(data.users);
			appendSystemMessage(`${data.username} joined`);
		});

		socket.on('userLeft', (data) => {
			updateOnlineUsers(data.users);
			appendSystemMessage(`${data.username} left`);
		});

		socket.on('error', (error) => {
			alert(error);
		});

		// UI Functions
		function showChatSection(data) {
			document.getElementById('loginSection').classList.add('hidden');
			document.getElementById('chatSection').classList.remove('hidden');
			document.getElementById('roomHeader').textContent = data.roomName;
			document.getElementById('roomIdDisplay').innerHTML = `<strong>Room ID</strong>: ${data.roomId}`;
			document.getElementById('roomCodeDisplay').innerHTML = `<strong>Room Code</strong>: ${data.roomCode}`;
			currentRoom = data.roomId;
			updateOnlineUsers(data.users);
		}

		function updateOnlineUsers(users) {
			document.getElementById('onlineUsers').textContent = `${users.length}/6 online`;
		}

		function appendMessage(data) {
			const messagesContainer = document.getElementById('messagesContainer');
			const messageDiv = document.createElement('div');
			const isOwnMessage = data.username === currentUsername;

			messageDiv.className = `flex ${isOwnMessage ? 'justify-end' : 'justify-start'}`;
			messageDiv.innerHTML = `
                <div class="max-w-[75%] rounded-lg px-3 py-2 ${isOwnMessage ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800'}">
                    ${!isOwnMessage ? `<div class="text-xs font-medium mb-1">${data.username}</div>` : ''}
                    <div class="text-sm break-words">${data.message}</div>
                    <div class="text-xs mt-1 ${isOwnMessage ? 'text-blue-100' : 'text-gray-500'}">${new Date().toLocaleTimeString()}</div>
                </div>
            `;

			messagesContainer.appendChild(messageDiv);
			messagesContainer.scrollTop = messagesContainer.scrollHeight;
		}

		function appendSystemMessage(message) {
			const messagesContainer = document.getElementById('messagesContainer');
			const messageDiv = document.createElement('div');
			messageDiv.className = 'flex justify-center';
			messageDiv.innerHTML = `
                <div class="text-xs text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                    ${message}
                </div>
            `;
			messagesContainer.appendChild(messageDiv);
			messagesContainer.scrollTop = messagesContainer.scrollHeight;
		}

		// User Actions
		function createRoom() {
			const roomName = document.getElementById('roomName').value.trim();
			const username = document.getElementById('username').value.trim();

			if (!roomName || !username) {
				alert('Please fill in all fields');
				return;
			}

			currentUsername = username;
			socket.emit('createRoom', { roomName, username });
		}

		function joinRoom() {
			const roomId = document.getElementById('roomId').value.trim();
			const roomCode = document.getElementById('roomCode').value.trim();
			const username = document.getElementById('joinUsername').value.trim();

			if (!roomId || !roomCode || !username) {
				alert('Please fill in all fields');
				return;
			}

			currentUsername = username;
			socket.emit('joinRoom', { roomId, roomCode, username });
		}

		function sendMessage() {
			const messageInput = document.getElementById('messageInput');
			const message = messageInput.value.trim();

			if (!message) return;

			socket.emit('message', {
				roomId: currentRoom,
				message,
				username: currentUsername
			});

			messageInput.value = '';
		}

		function leaveRoom() {
			if (confirm('Are you sure you want to leave this room?')) {
				socket.emit('leaveRoom', { roomId: currentRoom, username: currentUsername });
				currentRoom = null;
				currentUsername = null;
				document.getElementById('chatSection').classList.add('hidden');
				document.getElementById('loginSection').classList.remove('hidden');
				document.getElementById('messagesContainer').innerHTML = '';
			}
		}

		// Event Listeners
		document.getElementById('messageInput').addEventListener('keypress', (e) => {
			if (e.key === 'Enter') sendMessage();
		});

		// Initialize tabs
		showTab('create');
	</script>
</body>

</html>